{
	"info": {
		"_postman_id": "7682d22a-6191-4b1f-8504-284ed1655c72",
		"name": "El Buen Sabor",
		"description": "#  Get started here\n\nThis template guides you through CRUD operations (GET, POST, PUT, DELETE), variables, and tests.\n\n##  **How to use this template**\n\n#### **Step 1: Send requests**\n\nRESTful APIs allow you to perform CRUD operations using the POST, GET, PUT, and DELETE HTTP methods.\n\nThis collection contains each of these [request](https://learning.postman.com/docs/sending-requests/requests/) types. Open each request and click \"Send\" to see what happens.\n\n#### **Step 2: View responses**\n\nObserve the response tab for status code (200 OK), response time, and size.\n\n#### **Step 3: Send new Body data**\n\nUpdate or add new data in \"Body\" in the POST request. Typically, Body data is also used in PUT request.\n\n```\n{\n    \"name\": \"Add your name in the body\"\n}\n\n ```\n\n#### **Step 4: Update the variable**\n\nVariables enable you to store and reuse values in Postman. We have created a [variable](https://learning.postman.com/docs/sending-requests/variables/) called `base_url` with the sample request [https://postman-api-learner.glitch.me](https://postman-api-learner.glitch.me). Replace it with your API endpoint to customize this collection.\n\n#### **Step 5: Add tests in the \"Scripts\" tab**\n\nAdding tests to your requests can help you confirm that your API is working as expected. You can write test scripts in JavaScript and view the output in the \"Test Results\" tab.\n\n<img src=\"https://content.pstmn.io/fa30ea0a-373d-4545-a668-e7b283cca343/aW1hZ2UucG5n\" alt=\"\" height=\"1530\" width=\"2162\">\n\n##  Pro tips\n\n- Use folders to group related requests and organize the collection.\n    \n- Add more [scripts](https://learning.postman.com/docs/writing-scripts/intro-to-scripts/) to verify if the API works as expected and execute workflows.\n    \n\n## Related templates\n\n[API testing basics](https://go.postman.co/redirect/workspace?type=personal&collectionTemplateId=e9a37a28-055b-49cd-8c7e-97494a21eb54&sourceTemplateId=ddb19591-3097-41cf-82af-c84273e56719)  \n[API documentation](https://go.postman.co/redirect/workspace?type=personal&collectionTemplateId=e9c28f47-1253-44af-a2f3-20dce4da1f18&sourceTemplateId=ddb19591-3097-41cf-82af-c84273e56719)  \n[Authorization methods](https://go.postman.co/redirect/workspace?type=personal&collectionTemplateId=31a9a6ed-4cdf-4ced-984c-d12c9aec1c27&sourceTemplateId=ddb19591-3097-41cf-82af-c84273e56719)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "48042871",
		"_collection_link": "https://dpatroni640-5008872.postman.co/workspace/Dante-Patroni's-Workspace~bc3d1b94-de4c-4615-871e-07ba06830bb8/collection/48042871-7682d22a-6191-4b1f-8504-284ed1655c72?action=share&source=collection_link&creator=48042871"
	},
	"item": [
		{
			"name": "1. Login Admin",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();\r",
							"// Guardamos el token para que lo usen las otras peticiones\r",
							"pm.globals.set(\"token_seguridad\", jsonData.token);\r",
							"console.log(\"Token guardado:\", jsonData.token);"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"legajo\": \"1001\",\r\n  \"password\": \"1234\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "http://localhost:3000/api/usuarios/login",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"usuarios",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Crear Pedido",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// 1. Validar que el c贸digo sea 201 (Creado)",
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"// 2. Validar tiempo de respuesta (Performance)",
							"pm.test(\"Response time is less than 1000ms\", function () {",
							"    // Sub铆 un poco el tiempo porque ahora consultamos a Mongo y SQL",
							"    pm.expect(pm.response.responseTime).to.be.below(1000);",
							"});",
							"",
							"// 3. Validar Datos y L贸gica de Negocio",
							"pm.test(\"El pedido nace en estado PENDIENTE\", function () {",
							"    var jsonData = pm.response.json();",
							"    ",
							"    // Verificamos que traiga ID",
							"    pm.expect(jsonData.data).to.have.property(\"id\");",
							"    ",
							"    // Ahora debe ser \"pendiente\", no \"en_preparacion\"",
							"    pm.expect(jsonData.data.estado).to.eql(\"pendiente\"); ",
							"    ",
							"    // Guardamos la Mesa en una variable global para usarla en el siguiente test",
							"    pm.collectionVariables.set(\"mesa_test\", jsonData.data.mesa);",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{token_seguridad}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"mesa\": \"4\",\r\n    \"cliente\": \"Prueba CI/CD\",\r\n    \"productos\": [\r\n        {\r\n            \"platoId\": 1,\r\n            \"cantidad\": 1,\r\n            \"aclaracion\": \"Sin cebolla\"\r\n        }\r\n    ]\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "http://localhost:3000/api/pedidos",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"pedidos"
					]
				},
				"description": "This is a POST request, submitting data to an API via the request body. This request submits JSON data, and the data is reflected in the response.\n\nA successful POST request typically returns a `200 OK` or `201 Created` response code."
			},
			"response": []
		},
		{
			"name": "Mesas",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// 1. Validar que el c贸digo sea 200 (OK)\r",
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"// 2. Validar l贸gica de Mesa Ocupada\r",
							"pm.test(\"La Mesa 4 debe estar OCUPADA y tener PRECIO\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    \r",
							"    // Buscamos la Mesa 4 dentro del array de mesas\r",
							"    // (O la mesa que hayas guardado en la variable mesa_test)\r",
							"    var mesaTarget = jsonData.find(m => m.nombre === \"Mesa 4\" || m.id == 4);\r",
							"\r",
							"    // A. Validar que la mesa existe en la respuesta\r",
							"    pm.expect(mesaTarget).to.not.be.undefined;\r",
							"\r",
							"    // B. Validar el sem谩foro (Debe ser ocupada porque acabamos de crear un pedido)\r",
							"    pm.expect(mesaTarget.estado).to.eql(\"ocupada\");\r",
							"\r",
							"    // C. Validar items pendientes\r",
							"    pm.expect(mesaTarget.itemsPendientes).to.be.above(0);\r",
							"\r",
							"    // D. Validar el dinero (Lo que arreglamos al final)\r",
							"    // El total debe ser mayor a 0 (significa que sum贸 el precio del plato)\r",
							"    pm.expect(mesaTarget.totalActual).to.be.above(0);\r",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{token_seguridad}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://localhost:3000/api/pedidos",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"pedidos"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "id",
			"value": "1"
		},
		{
			"key": "base_url",
			"value": "https://template.postman-echo.com"
		},
		{
			"key": "mesa_test",
			"value": ""
		}
	]
}